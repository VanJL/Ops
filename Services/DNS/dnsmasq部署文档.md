# dnsmasq 部署指引

> 本章节介绍了dnsmasq的使用，以及如何快速的部署一个内网DNS服务器。



## 产品介绍

Dnsmasq是一个开源的轻量级DNS转发和DHCP、TFTP服务器，使用C语言编写。Dnsmasq针对小型局域网设计，资源占用低，易于配置。支持的平台包括Linux、BSD、Smoothwall、IP-Cop、floppyfw、Firebox、LEAF、Freesco, fli4l、CoyoteLinux及Android等，并且在dd-wrt、openwrt路由器系统中也有使用。

Dnsmasq提供DNS缓存和DHCP服务功能。作为域名解析服务器（DNS），Dnsmasq可以通过缓存DNS请求来提高对访问过的网址的连接速度。作为DHCP服务器，Dnsmasq可以用于为局域网电脑分配内网ip地址和提供路由。



## 原理介绍

- 本机APP访问主机的/etc/resolv.conf获取DNS Server，该文件指向的DNSServer为Dnsmasq。

- 本地局域网中的主机可以直接访问Dnsmasq，即在这些主机中/etc/resolv.conf指向了Dnsmasq。

- Dnsmasq需要通过上游DNS来进行域名解析，上游DNS可以配置在/etc/resolv.dnsmasq.conf中，该文件需要在Dnsmasq的配置文件/etc/dnsmasq.conf中指定。



## 部署步骤

1. 安装软件（配置基础镜像源即可安装）

   ```bash
   # yum -y install dnsmasq
   ```

2. 修改配置文件

   ```bash
   # cat /etc/dnsmasq.d/shinefire.com
   
   address=/iscsi.shinefire.com/192.168.31.228
   address=/iscsi.shinefire.com/192.168.31.229
   address=/rhvm.shinefire.com/192.168.31.230
   address=/rhvh1.shinefire.com/192.168.31.234
   ```

4. 修改自己的/etc/resolv.conf

   ```bash
   ~]# cat /etc/resolv.conf 
   # Generated by NetworkManager
   search com shinefire.com
   nameserver 192.168.31.228
   ```
   
4. 启动服务并设置为开机自动启动

   ```bash
   ~]# systemctl restart dnsmasq.service
   ~]# systemctl status dnsmasq.service
   ~]# systemctl status dnsmasq.service
   ```

6. 


